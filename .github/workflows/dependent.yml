name: Notify DreamWeave Ecosystem

on:
  workflow_call:
    secrets:
      DW_BOT_PAT:
        required: true

    inputs:
      aur_package_name:
        type: string
        required: true

jobs:
  notify-dependents:
    name: Notify Dependent Repositories
    runs-on: ubuntu-latest

    strategy:
      matrix:
        target_repo:
          - DreamWeave-MP/DW-tools

    steps:
      - name: Create Update Issue
        env:
          GH_TOKEN: ${{ secrets.DW_BOT_PAT }}
          TARGET_REPO: ${{ matrix.target_repo }}
        run: |
          ISSUE_TITLE="ðŸ“¦ Update ${{ github.event.repository.name }} dependency to ${{ github.ref_name }}"
          RELEASE_URL="https://github.com/${{ github.repository }}/releases/tag/${{ github.ref_name }}"

          ISSUE_BODY=$(cat <<EOF
          ## ðŸš¨ Dependency Update Required

          **Source Repository:** ${{ github.repository }}
          **New Release:** [${{ github.ref_name }}]($RELEASE_URL)
          **Released By:** @${{ github.actor }}
          **Release Date:** $(date -u +"%Y-%m-%d %H:%M UTC")

          ### ðŸ“‹ Required Actions
          1. Update dependency version in your repository
          2. Test the integration
          3. Close this issue when completed

          ### ðŸ”— Useful Links
          - [Release Changelog]($RELEASE_URL)
          - [AUR Package](https://aur.archlinux.org/packages/${{ inputs.aur_package_name }})
          - [Source Code](https://github.com/${{ github.repository }})

          *This issue was automatically created by GitHub Actions.*
          EOF
          )

          echo "Creating issue in $TARGET_REPO..."

          gh issue create \
            --repo "$TARGET_REPO" \
            --title "$ISSUE_TITLE" \
            --body "$ISSUE_BODY" \
            --assignee "${{ github.actor }}"
